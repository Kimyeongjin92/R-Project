---
title: '[과제13] 네이버 리뷰 크롤링하기.'
author: "김영진"
date: '2019 7 3(수) '
output: html_document
---
```{r}
library(rvest)
library(xlsx)

cine_url <- 'https://movie.naver.com/movie/bi/mi/pointWriteFormList.nhn?code=173123&type=after&isActualPointWriteExecute=false&isMileageSubscriptionAlready=false&isMileageSubscriptionReject=false&page='

urls <- NULL
for(x in 1:50){
  urls[x] <- paste0(cine_url, x)
}
length(urls)

total <- NULL
score <- NULL 
reple <- NULL
name  <- NULL
date  <- NULL
like  <- NULL
hate  <- NULL
for(url in urls){
  html  <- read_html(url)
#  total0<- html %>% 
#    html_nodes('.total') %>% 
#    html_nodes('em')
#  total <- c(total, total0[2] %>% 
#               html_text())
  score <- c(score, html %>%
               html_nodes('.score_result') %>%
               html_nodes('.star_score') %>%
               html_node('em') %>%             # .이 있으면 class 없으면 tag
               html_text())
  reple <- c(reple, html %>%
               html_nodes('.score_result') %>%
               html_nodes('.score_reple') %>%
               html_node('p') %>%
               html_text())
  name  <- c(name, html %>%
               html_nodes('.score_result') %>%
               html_nodes('.score_reple') %>%
               html_node('dt') %>%
               html_node('a') %>%
               html_node('span') %>%
               html_text())
  like  <- c(like, html %>% 
               html_nodes('.btn_area') %>%       
               html_node('strong') %>%
               html_node('span') %>%
               html_text())
  hate0 <- html %>% 
    html_nodes('.btn_area') %>% 
    html_nodes('strong')
  hate  <- c(hate, hate0[grep('notSympathy',hate0)] %>%
               html_text())
  date0 <- html %>% 
    html_nodes('.score_result') %>% 
    html_nodes('.score_reple') %>% 
    html_node('dt') %>% 
    html_nodes('em')
  date  <- c(date, date0[-grep('onclick',date0)] %>% 
               html_text())
}


Naver_CINE_Review <- data.frame(date  = date,
                                score = score,
                                reple = reple,
                                name  = name,
                                like  = like,
                                hate  = hate)

write.xlsx(Naver_CINE_Review, file = "네이버 시네 리뷰.xlsx", row.names=T)
```

